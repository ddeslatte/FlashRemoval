# Define log directory and file
$logDir = "C:\Log"
$logFile = "{0}-{1}+FlashRemoval.log" -f $(hostname),$(Get-Date -Format 'yyyyMMddHHmmss')

# Create directory if it does not exist
if (!(Test-Path $logDir)) {
    Write-Host "Creating log directory $logDir..."
    New-Item -ItemType Directory -Force -Path $logDir
}

# Start a transcript log
Write-Host "Starting the log..."
Start-Transcript -path C:\Log\$logFile -noClobber

# Assembly required to close file handles
Add-Type -TypeDefinition @"
    using System;
    using System.Runtime.InteropServices;

    public class FileHandle {
        [DllImport("kernel32.dll")]
        public static extern bool CloseHandle(IntPtr hObject);
    }
"@

# Function to forcibly close file handles
function Close-FileHandle {
    param (
        [Parameter(Mandatory = $true, ValueFromPipeline = $true)]
        [string] $FilePath
    )

    Write-Host "Closing file handle for $FilePath..."

    $processes = Get-Process
    foreach ($process in $processes) {
        $handles = Get-Process -PID $process.Id -Module -ErrorAction SilentlyContinue
        $fileHandles = $handles | Where-Object { $_.FileName -eq $FilePath }
        foreach ($handle in $fileHandles) {
            [FileHandle]::CloseHandle($handle.Id)
        }
    }
}

}
#Defining GUIDs and SIDs here
#Below are GUIDs of each version of FlashPlayer that can be found by Searching "Flash Player" in this Key: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\ or archived full list here https://helpx.adobe.com/flash-player/kb/msi-guids-windows.html
#There are separate keys for ActiveX, NPAPI Plugin, Opera-Chromium Based as well as x86 and x64.  All Are listed below.
$GUID = @("{685A56F8-75B6-44AD-B3DA-FB0A3266B47C}",
"{2BD2FA21-B51D-4F01-94A7-AC16737B2163}",
"{922E8525-AC7E-4294-ACAA-43712D4423C0}",
"{B7B3E9B3-FB14-4927-894B-E9124509AF5A}",
"{24762012-C6C8-4AAD-A02D-71A009FA1683}",
"{66E3BA00-6B3D-466B-96FA-6309A7F42BB0}",
"{148D9D03-5D23-4D4F-B5D0-BA6030C45DCF}",
"{6E9EF98E-259E-416D-B5F8-0ABDB99942CE}",
"{FFB768E4-E427-4553-BC36-A11F5E62A94D}",
"{406A89D6-09E6-4550-B370-8D376DDB56BE}",
"{95468B00-C081-4B27-AC96-0A2A31359E60}",
"{E5D03B2E-B2D4-477F-A60D-8E1969D821FA}",
"{18BBF24A-6D04-4CA4-B6B4-1CF372162EEC}",
"{B001064C-D061-4BAE-9031-416A838D5536}",
"{FA1D6742-0515-4A94-AD5D-F0484026E4A2}",
"{DCC90D9D-4F8D-4A06-9050-ADDB284FF9FA}",
"{A6FD09C6-E363-4986-8ABD-2165B4485EEC}",
"{88D881EF-0567-443A-9A84-E5AAEF29BB34}",
"{0483BE07-260D-4E4D-815E-F737C0A72E40}",
"{48DB5914-8772-472D-B8DF-E2092BE598F6}",
"{72D4DD4C-0749-4352-B63E-7A7C9286430E}",
"{04AC84BF-0247-41F5-BE18-4323692D4D14}",
"{B740AEA8-16F8-47F2-8ED9-F641F8E7DE38}",
"{545AB432-5EA3-4E26-AD2A-7B8266D3E8D1}",
"{18D81F4C-2630-48BD-81DF-F4204961142A}",
"{35EE1E97-3078-47B5-91FE-F8FBD0E933FA}",
"{A02F6814-1AB0-49EC-B608-458386448A68}",
"{C20480E4-99B7-44FC-A21B-7CFFBCFFCD94}",
"{C8C81DD6-A906-4856-91FA-F43DB92BEB99}",
"{E24A0015-C73F-4B57-B8DF-5EB84D2E9685}",
"{54DAAD16-A57A-4524-9C4F-391500945D14}",
"{36B194F6-D57F-4E58-B99D-9A4565356A66}",
"{FEE2740C-D52A-4C76-8857-335E35AB7037}",
"{212719F5-89EE-4B3A-A8EB-121D931E5547}",
"{2B2D7C9F-F652-4C9C-86AD-7298D2989D88}",
"{5C017C03-0DCF-47DD-8113-9CDE442C30E}",
"{35685EF6-CB29-4FDE-8950-F570ED2BACB7}",
"{CBCA1B4E-1DB3-4BBF-BD05-CF3A3F2CC32B}",
"{1BB7D2BB-D4EB-4680-A707-FC3D526E90A1}",
"{4A414069-F7DA-4885-8356-A87F7C4AE95B}",
"{B360F50F-29AF-4A62-B649-82EB8F4D87A8}",
"{DB093E0B-0934-4183-BA60-5C1ADC9F6424}",
"{A10EE46B-C2E8-4FAB-A8F8-3E80D0662BA9}",
"{23D79730-EC1A-435E-83F8-AAEBFE5237B0}",
"{421976B6-DEC6-4CA5-941F-F0663B3A2B74}",
"{4278B780-6CB5-437A-BA6A-31C7F9FAB980}",
"{62DD0E85-7A25-47A4-8F0F-95D749F9F102}",
"{D0F112BB-7902-43AC-AF50-4D1117C9152E}",
"{8D7DDFA2-3A50-49A4-99C5-6D8BE66FE0B9}",
"{E7C06D29-B16A-4D88-A917-55422FAB4E9D}",
"{5C804EBB-475F-4555-A225-1D6573F158BD}",
"{8DB09D25-8E79-4F23-854D-02B95062A5B2}",
"{9E25236A-E313-4853-9C8C-DB7015E9F9C4}",
"{6B393C32-A8CE-4663-9D5B-EA75C8D1233C}",
"{F40AC5E5-55AB-469A-BA8B-839CE0146380}",
"{A13AB67F-697F-47DC-AA7B-F70B8B7ACDB8}",
"{CE7292AE-2A40-4D73-820F-0A5015A8610D}",
"{DC48E09D-4E5F-4039-B93A-FCED36EFBE55}",
"{BEE621F9-F94D-493C-BC45-D1B315DC8839}",
"{98616875-CF30-4BE5-AAED-36EF4AC6EE27}",
"{A02F7026-D635-465C-80D8-FB47AF185934}",
"{25F2AB39-E3DD-4cd7-8697-E98CF27BA1F1}",
"{CA6C70E3-1878-47c3-97BA-8DB0E2221511}",
"{3F67CDB0-824E-435E-BE14-D7BCA8256E3E}",
"{6F702A65-629F-4E5A-B686-1A4826C83AB4}",
"{D01750A5-49E5-4BF4-92CC-F72F5F20DBEC}",
"{EB08D51E-BA72-46FA-94B2-CBA9CF8973D8}",
"{8A5F5F0A-BE2D-4763-B764-BF6EFE93A68B}",
"{6BA9BA04-B062-42F4-A852-902229FD4C2A}",
"{DFD2729F-A436-4EAC-B116-2FE589F6D9F6}",
"{9223BBDE-693D-4B5F-A1DE-C40C7D2E4C89}",
"{676E4C31-0CD1-454E-BE3A-70D3AC93F915}",
"{F68D0307-2573-4BE7-9EFD-CB28D7E656E3}",
"{35D1A5B9-9152-4C8E-A927-D058E6C85DAC}",
"{5EB86CF5-E052-42F8-8635-C1AF08DAC792}",
"{D6F3EA3B-0E14-44A0-A89E-FEE53936806F}",
"{CBD6CD82-1CC4-4A13-9782-7BECD48835EB}",
"{557262A0-7139-4A0F-A17C-B6DC9DDF3075}",
"{86812AB8-22B3-4837-9949-352A20F08DE4}",
"{CA412FD3-C6D0-40A0-AD9F-F79B071B83EB}",
"{43AECACC-B291-4508-9FB7-6FF7E5790F16}",
"{F817F280-7A46-4110-88E1-1D89BBF133E9}",
"{E151098E-4C94-4E8D-8003-F03E2E28246C}",
"{827AFA85-AB04-4CDE-91AA-3D146748F83D}",
"{41501415-D0BC-4692-88C6-D401DDFEAA0E}",
"{3D405E2A-C13D-45D0-902F-F8F3DD65A59}",
"{E94EFAB6-653F-4837-9E8A-F6377CA1EC0D}",
"{4CFE23CC-779D-4572-A76F-AB60A958BC79}",
"{01CC2860-A3CD-4D57-98A5-B202CA6B04ED}",
"{EFC4BB62-CD01-4F63-9165-FC5DEB350469}",
"{41042E28-CCA1-4147-869F-9E928B38F04C}",
"{E4FFDAFD-7E94-4C17-AA7F-FA2CC0B879FD}",
"{52793F88-BF4D-4AA6-8696-80E72CE758B1}",
"{60AED4A0-3092-4DF4-A0A2-31F121122E92}",
"{B01EA176-C775-4490-B4CC-938A4B3EF5A3}",
"{8F9B1C8E-F50E-4139-8701-45016021E102}",
"{3799ACD7-66E2-4749-A851-95E1193B217D}",
"{1BBE4C53-634B-44B3-8693-314ED6260557}",
"{100BB994-8C7F-4330-A410-7E2F25D69644}",
"{A23891C3-11A8-4CB4-98AF-9B07D410522D}",
"{1843BFAE-C2A2-4D56-B1F3-190158875039}",
"{757B0EDB-B853-4CF7-A2CD-965659D1ADB7}",
"{3EEF849D-AA3C-44FC-A126-68ED759EE426}",
"{64F1F0CC-4171-4397-8153-B8EE77C20546}",
"{10B037CE-CDF6-4B7F-85DC-057CBE774FB7}",
"{F8DD47E9-1C18-4760-9A9B-EB96BB31D0BE}",
"{D94CF88E-0AD2-4E06-87C4-77D4B504194F}",
"{34AA7FE6-26AD-40C4-8622-CE1AE517BA46}",
"{34151179-793B-4CBE-93C3-6C623EA440D1}",
"{939659F3-71D2-461F-B24D-91D05A4389B4}",
"{AB2684F2-6AD4-4D6A-9FF1-A62871AA28D2}",
"{DECE2B50-5636-4AEC-AC09-E31054CBF507}",
"{B174F730-053E-4FF6-AC5C-7D3F9FDF18D4}",
"{A5DAA25C-618D-4551-8F35-BAD434C5A41E}",
"{B407A8DC-E431-4DD1-9244-0605FF43E012}",
"{767041A3-1A88-4E35-AAB3-92B33738158C}",
"{D59F17C5-EADC-4216-8206-B6E4F61DE5FA}",
"{3506FAB6-223F-4917-8A39-E2EF365A3E78}",
"{1F5E5F2E-5E61-431D-B796-58CCC6B68E28}",
"{C4B95D2E-BDE6-412D-AF7B-EC43A298C55B}",
"{15AE611F-5A40-4BD0-9291-1C6856BDB9A4}",
"{047904BA-C065-40D5-969A-C7D91CA93D62}",
"{904CD3A3-7A9D-4932-8316-95A7A6D2FB4A}",
"{BC8AC77D-6A6F-491F-BEED-2958F09C6CAE}",
"{3CA17ADC-2146-49C2-A375-972BB57CF7F6}",
"{7C548501-3501-468A-A443-CC42F5B3626B}",
"{B21D5938-6B90-408B-B827-92F6E0E11B48}",
"{70F97130-DBF6-4885-854C-CC7A80FC65E1}",
"{2BE0DC49-FA94-4853-A62A-F1E02ECAA67E}",
"{465571A6-29A2-4D39-B77D-3A1F6C964B65}",
"{68BC8140-3FAA-4419-B6EE-CCF60BE6DAB2}",
"{8C901387-B304-404D-93C0-E2E0C2D53D90}",
"{4EF54F47-BD29-4049-AEAF-A80E494A6A45}",
"{506B121D-1B93-484D-8241-6250BCB736C7}",
"{9F5C6A1A-3B30-4AD5-B998-2885AA7C26A7}",
"{901E9B21-CDB1-4C4A-ABFC-61A554912BED}",
"{57B3953E-BB96-418D-9228-57B7082B921A}",
"{B3DADA45-F0ED-48FD-946E-7E82C2229D59}",
"{A4488E5C-1022-432A-8066-72E1C4023310}",
"{7AF47D49-5F6B-4646-84FA-5802C635B082}",
"{D10AEF4A-DD94-4F6C-9CBF-580C1A1F6D05}",
"{AD6E9D76-C6AA-4F6E-8DAE-4EEE78B78743}",
"{521CCA6C-F8FD-47ED-AF9A-2461352E34DD}",
"{BD2339D5-5609-4DB0-A89F-D427B7B353E1}",
"{5682D3D7-0E22-4AC5-8DAD-5375A1F7B313}",
"{AA4C5C0F-AE8D-4760-A513-F2F3109D8C9E}",
"{B5F916C4-638F-4FFE-B5D7-D24504224543}",
"{87FB4D1F-413A-4F3F-AAD9-0B130A02BA61}",
"{4B4910C8-4D59-4AC2-9E72-15B9D91CEBB2}",
"{D0AFDE5A-16FE-40B0-908D-63A5F23A3E7F}",
"{37CFB473-A66E-490E-8ED2-07C984BC42F5}",
"{401B651E-4CCC-4177-B16D-1B88EC9FDFB3}",
"{84562166-378E-40C3-8937-FEAB57BD34C1}",
"{07ABFA96-7AFE-43C2-9BC2-1005C24D2316}",
"{FDAF247B-4ADD-4089-A799-B08206B8E75C}",
"{70F0F88A-387B-40EB-93BD-9877DB9D668D}",
"{EE56217C-B3F9-402B-B4EC-63F090F51D3D}",
"{44CF4DB9-707A-4395-839C-573FBC206CB9}",
"{56680CC0-AA4D-47DB-A1A3-B26A97F1D3F1}",
"{8B4393AD-53A8-4895-803D-3AEECD99D620}",
"{D21D7AFD-8DF3-4EF0-B81B-A2AA5AEFE713}",
"{89D2A20B-74C2-4A70-B598-AA4F4DFC0EBF}",
"{92C34178-B679-4C83-AC33-7EFCE6D36E01}",
"{BE35B211-E66A-480F-ABE7-86CF5316F830}",
"{5708517C-59A3-45C6-9727-6C06C8595AFD}",
"{FA944726-00F8-43B5-BB97-33E6FF409C22}",
"{42E870AA-8C2E-4764-9340-31A693D2E033}",
"{392DC543-3818-4DCA-B95E-C587D83E1C20}",
"{316462DB-82C6-4856-BA1F-2FDFDC08799F}",
"{3898EF12-76AA-4116-BFCE-EA063420B9E2}",
"{381EE08C-2992-4F52-9A69-4997974C0EEE}",
"{6E6D2BB7-B844-4842-B62D-0A7F0AA7884E}",
"{559A2FA4-4858-46E7-BD02-68C15A31DF98}",
"{58E533B1-9B29-432D-BB38-25B489C1D53B}",
"{22AF9D99-A980-4071-A0BD-1D0BB956B9EA}",
"{BBFE8F5D-C440-45C7-B9C5-B6445D2C9B56}",
"{A028A66B-0FC8-4C97-8A8C-2E6CE3548B55}",
"{5FB01CD4-E37C-4205-BA81-3B4E8C2781F8}",
"{5521201C-EFA3-4457-B915-676C198BE9EA}",
"{661B0F8A-EF40-4100-AE83-50A5E1602EF5}",
"{3D5E2F56-60D2-4B5F-802E-9EAF7DC2E8E1}",
"{D7830E9A-5E0C-4BD5-8724-0F89757EBF07}",
"{642DD84E-9F7B-4699-90A6-8256A4B156F0}",
"{EC1EBF60-4B76-446B-B5C2-1A9BB3FA2F2F}",
"{660354E6-6AF9-4E00-A2E2-E728A5777450}",
"{25B9B97A-0B1F-4826-9433-17DD1AC643BF}",
"{AA0A9F80-F040-45BB-9173-CF1ED82C5924}",
"{BDAB53BA-1AEA-4653-B1FB-CAF6AA938ED1}",
"{6DD0C815-C939-4082-9BBF-629E0EB91B5C}",
"{C4665839-5F86-4F82-90B1-FF35F0FA2DDE}",
"{49EA1F7D-C5CD-46F8-90D8-86999220DB05}",
"{A911056C-E170-476A-9C9E-9E0500E6DC6A}",
"{503E5436-A9D1-418B-95EF-B6AC4B2D9C82}",
"{34EB2624-90E9-4F9C-8821-B421B7EF6884}",
"{ECCB1019-16A6-49EF-A2F9-E85777C1C588}",
"{BE89321A-5C9A-43F8-9062-1657BF34D448}",
"{CCB32C6D-BBBA-42BC-93BF-190BCECC7691}",
"{EABE2507-8FBF-4B2E-A8A0-5F3271E68383}",
"{FC32926C-020A-4350-9449-D9530B2DC621}",
"{139F0069-8E2E-44DE-BF57-964A587C105D}",
"{B369CF1E-FB91-4A99-B8B3-D7F44F19C01B}",
"{ED2C2C02-109A-48CD-9EC7-0FB70447346E}",
"{55F6C148-A47A-4280-8CB0-EE2B3AE261D0}",
"{B77CF588-97F8-4FD3-91C6-89ACB74DFFFD}",
"{3FD02394-83BE-4FCF-98C9-3FBD5E210F1E}",
"{5A4869EF-A2DB-4A31-ACD1-B5FA957BA58B}",
"{FBF7272D-117B-4866-9765-8506B92401BB}",
"{6160ECC9-F788-493B-BCC2-4FB8DE7E0C55}",
"{E5318F04-AB59-49EC-88F3-32A26B40C667}",
"{37ECC7FD-3092-4328-A20E-384BF0A31D95}",
"{88DDE26B-2834-46D7-8EAA-7BE2C9266DB5}",
"{A13B841B-2210-4C3F-BB15-6662AE50AF39}",
"{9F9F7C14-9619-4963-82C9-74AA173D29E7}",
"{7E6B86FA-B36F-4E18-B697-D66F36A83A9F}",
"{94E82D59-AB79-4BA7-A2A6-5398E5139239}",
"{EE78979C-BA36-46D2-B340-24A71A23A100}",
"{A398FEA4-8F95-49A6-89BF-58E1077D161B}",
"{BA5712B2-6690-4444-88E0-373037EB7F0A}",
"{3916E208-4327-453D-8C9F-FFD6349C7855}",
"{539DA102-9BE0-4FA7-B740-066CB966C6F9}",
"{8D6EEA89-29AF-446F-8421-998CD7FC1E72}",
"{53709C63-7D6C-4AA2-8E68-20880F421A0F}",
"{71D817A2-F2F7-441C-97F8-04804E4E784F}",
"{DB20CEA5-4E6C-4BDC-B9AA-4947D71AD2A2}",
"{902F931D-087E-4B8D-AE0F-31C8AD771DE1}",
"{68C199AA-8269-4A53-97DE-31A6DC846565}",
"{EC3824BD-5C1D-45C4-BCF8-2F665AE5D4E6}",
"{F55F2C64-FAB2-4633-B921-C0C0C0723E0B}",
"{AE88A3AD-56ED-48BE-B246-311BEF4215AE}",
"{C6CE014F-F4EC-4B99-A124-E45BCCAEB032}",
"{438F4311-4F05-4195-BA5C-E16CBD95E140}",
"{9E8629C9-29BF-4F8A-8F88-6A127958D2F8}",
"{5FAF5D48-EBE7-49F4-90F1-263BF0A1E99B}",
"{8E9DB7EF-5DD3-499E-BA2A-A1F3153A4DF8}",
"{58BAA8D0-404E-4585-9FD3-ED1BB72AC2EE}",
"{74B3FB8A-2A0F-4CEA-84FD-12C9B03EE377}",
"{6FEFB724-6655-492B-9D10-00F530FC39D3}",
"{BB65C393-C76E-4F06-9B0C-2124AA8AF97B}",
"{9BA8B441-9E83-4307-A582-03EC9A456C72}",
"{BB79ADDE-9369-44C4-84DB-221C853ABEDC}",
"{C64CF7F5-92A0-4615-AA2D-A1237AD3F332}",
"{4FB5B082-6906-4764-9486-332393B33C9F}",
"{2CB88388-9DFB-46f7-B7F1-862EB29A6FAB}",
"{8186E1B9-DDC6-45B6-B9EB-C28947CBC4CF}",
"{786547F9-59BB-4FA3-B2D8-327FF1F14870}",
"{3F490EB6-7C6C-4208-93FF-6AC925FA64C8}",
"{ECA1A3B6-898F-4DCE-9F04-714CF3BA126B}",
"{64001313-1B41-4457-B884-049984772E6F}",
"{0DFB3DE8-65B9-44FF-AA0A-3BECC5A2BFD1}",
"{D09E3C22-6573-4723-9962-B3B2ED761754}",
"{AF36CE1D-FD2C-4BA0-93FA-1196785DD610}",
"{35F7D0BF-08AB-42E3-A403-AF9772AC216A}",
"{BC41C09D-FAA9-4346-9FE6-1E0017BC551A}",
"{1C5EC8F6-5C5F-421F-85BE-919B5D0CAD4C}",
"{012CE096-06BA-4f46-8E89-0B4F900E7479}",
"{343DB62F-891F-45EC-BED3-E2F56CEB1B7C}",
"{E6725026-A650-449C-897B-D6B7A5EEA058}",
"{FC619975-A025-4B54-873C-FDF000B90261}",
"{9C542173-96F0-435D-A95C-468CAAC75EA0}",
"{F473C85C-1FED-4D0A-8155-E97AC7E43C9D}",
"{B7BDAF22-9647-4846-8EA9-6E0A5B785651}",
"{4ED0DB47-769D-4B71-8724-E7A5BFEA1D51}",
"{53F29A32-7D03-4635-A8B3-839D921F6F96}",
"{F9D68131-7490-4448-AC45-7BBFB3392F8F}",
"{8B234375-EFB1-4024-8B53-EA7C745A6687}",
"{3F0A399A-7A05-4703-8526-79180107DB95}",
"{47545D22-ED99-4F7D-A86F-7C340DA89394}",
"{83FD3AE7-7C0B-476B-8F97-4331838588D1}",
"{30CCDF87-4B16-4C36-A258-0B648CF2B661}",
"{116F6F0C-0D10-4173-8152-83BD6CEC9436}",
"{A3FFDAD9-B0AA-466E-B5EE-CFC0A65FA520}",
"{604AB3D8-A8D1-442D-871C-F00A34C95B22}",
"{8FCFFDB4-A83E-4B89-A565-7ED864A97EE5}",
"{FDBF4291-7DDB-4C5C-B128-332A46CF8FFA}",
"{1B771BDD-6B21-4C61-A458-226910A9C01B}",
"{10C35266-87DE-471F-B3C9-9AD0CA0315DE}",
"{F9D28ACF-D568-4D4C-9601-2ECEE27479A3}",
"{55D873F4-67F0-4BA8-B735-06A5B99AFFE1}",
"{1F282E23-66C7-46D3-B23C-70A53342DD4E}",
"{99BEFA2A-9084-437E-BE21-40F850C1CF47}",
"{F78DFF86-B53D-4D6D-AB2B-573C0A7AA856}",
"{AB47EA27-9FE1-4775-BEFC-4AAEEE2CB53E}",
"{95758145-3B5B-4874-B062-597C8E450EA7}",
"{B44F81C9-FF56-47B6-856E-48122BD7209D}",
"{B8D23026-32DC-4B94-A25D-E4C8AE02048F}",
"{8FC6B896-6F86-4957-AC1A-077A755C4F08}",
"{CA6DA0CF-2852-4407-ADE2-CA6281C8CE9D}",
"{66EE3C89-25FD-4D8F-BC01-B94B25B9D03F}",
"{063C0043-E954-4850-9AA7-F9BC4E920D38}",
"{4ABA8D5B-55F4-4254-905B-ACF8AAFF84EE}",
"{9243F09B-3319-4A55-8181-9BCEC7391079}",
"{35E1B1BF-D8E5-4B7F-9FD6-87D2E5694015}",
"{F7090575-8BDC-4A14-8D00-C0FB2BC914BD}",
"{0F2C43BC-2B06-4684-BC2E-C922056DE90C}",
"{F1F9D254-FBB7-4634-9481-BEF1312255FE}",
"{12F0097F-68B4-40AB-A968-318D369027EC}",
"{1E4B6678-A507-4B6A-B6C7-FEE55FC0C14C}",
"{B2883418-71EB-4F63-97AB-222C67E99358}",
"{5D8B877C-945B-49F5-AA48-776C81C11B56}",
"{E648FE50-7E0B-45E2-92ED-AB1FD4493293}",
"{4B8E09CF-2A5D-454D-9114-9B8A84A76F3B}",
"{3D3085B0-BC4D-4559-B0AE-F5C879DEFFC4}",
"{309970D0-D0E2-49AB-B9A2-80F48E22947A}",
"{417EF49A-B315-449F-9652-85C8CB988042}",
"{9BFB1FAB-8FC4-4FAA-9B2D-2B121834B659}",
"{4C85A58E-48BA-4252-90C5-C9CA5E0C83D7}",
"{05AADFE6-43D6-4c7c-9433-5F6EF02BF44F}",
"{395CFBE7-19F1-4494-8ECF-6392D459CE0A}",
"{97E0DCFB-4CBE-4DA6-955E-B8E4DE37E466}",
"{8C27E4F1-9CE6-4C32-ADBB-D51CD226649E}",
"{709D081A-4E86-43F5-9D67-6EAF47EE585E}",
"{2F475153-E8DF-4439-9B7C-77A29E10DD67}",
"{539B6B38-4ECA-4ED7-B7B2-F52D923D1306}",
"{42C336AF-2C66-4591-BC6D-F67F2C424E6F}",
"{23639B51-AF52-4FD4-80DD-DCC3F1BA5232}",
"{B7CCFDCA-D172-4477-91CC-91B726F64A1F}",
"{60BC9A62-6750-4B8C-9074-99ED76F374E6}",
"{346137E0-7160-403B-AD21-3FF01D25037B}",
"{18F2220F-0A39-446E-B737-637F0DBB3B8C}",
"{4036771A-B714-4CA1-8931-782B24EE672C}",
"{CEF7692A-E3E4-4780-82E0-51B2D59CC1F0}",
"{A201D972-5F10-4FE9-80A4-E3E52E8EDCE8}",
"{9B8F9D56-F8FA-4A69-B6F1-F4CB8EACD428}",
"{F1939C62-126D-49F5-8A79-D9BFB73B61C1}",
"{437BC114-8BE6-4325-8A5C-08BD7071C0D7}",
"{E0ADA71A-469B-48EA-BDED-F6FD346A5A33}",
"{B457C45C-333D-45FE-BCB8-2279CEF42C80}",
"{216B433E-B031-42D6-9ECE-C8AA929CE15F}",
"{7FABC035-13F6-4494-A931-F04CCE4E60A9}",
"{64C9A479-9E77-49C3-8E98-CA03F2DB3758}",
"{BF32A7A6-E945-4688-99E8-D420144CB82B}",
"{A2497A20-8029-4AB9-B4A5-9DAAB3DBF177}",
"{BFBC6337-B7B9-4AEE-BC19-CA910EED755D}",
"{0D1FB7FD-8CB5-4A50-8311-17A2395B6EAE}",
"{91A605E2-0372-4198-B64D-FA4D7E9FC851}",
"{F83DD803-2467-4D07-9D6F-87AF0434410A}",
"{E1915B85-E4E4-44E4-B26B-3D16B04D04FC}",
"{934168C8-55AC-4593-A138-E64BA8367E6E}",
"{04840A3B-858C-46A5-8BBD-FFDB4C111FEB}",
"{9D32CD07-EA5C-4A79-B976-C0C7F975EDE4}",
"{28ADCCAD-3C23-44A1-A93F-47AA176F7AD7}",
"{38C8C329-5AB3-480C-86FD-C18D10FBD39A}",
"{ADEE751B-09AE-4DA7-9658-DCF90E8F9ED7}",
"{94CF93E4-D8F3-447F-97E9-FAF7BEC930C7}",
"{600F72B0-17BC-4450-9395-4D7655396D8D}",
"{AF5D72E1-61FE-4EF4-931C-42723FFF7B7C}",
"{F7B1E4E3-9BCE-48AE-AB52-A1C11BD41036}",
"{9ED08B6C-6382-43D7-AFE3-012594816097}",
"{40DB03C1-74D7-4BDE-A3C4-A14D511B25B3}",
"{723A8BF1-E4C7-45BE-9DCE-DFBD5679282D}",
"{5499A232-C14F-4B5D-87D7-406DBCC0BE26}",
"{20E42B30-2CA6-41CE-925E-81AB68CE1D19}",
"{D831C533-ED8C-4153-89E2-B89431763740}",
"{1E7F709D-6734-4EE2-9235-4C81044D4937}",
"{9B84A461-3B4C-40E2-B44F-CE22E215EE40}",
"{090316ED-311C-4D3A-800D-00489F4AE72B}",
"{3D3B7419-EA99-48DE-8697-CA6097E61E2C}",
"{888AD354-C0C8-4C51-AC57-FC48ABB20493}",
"{2DC1B60D-D975-4564-AC14-11334616E8E8}",
"{F790FC04-EB94-476B-9CAB-2E26C6C9164C}",
"{EE6D7C33-B6E1-49C1-AB9E-6A3EE22E8B22}",
"{D1E6CE92-F6B3-41C4-84BB-A34758ED873D}",
"{94C9B4B4-E73D-4302-B476-64ECFE0691BA}",
"{C4B32291-F7B2-4BEC-BA4D-4195676A08CC}",
"{3FC9A6DE-C105-4576-8F63-656FFB1BF8EB}",
"{16E20D9D-E7E2-4951-A944-6FFC40870AD4}",
"{6CBBF19C-2B69-4143-81C4-D5B56D32088C}",
"{AF82C1A9-56DC-4CCD-A36C-CAE56D541DFA}",
"{10F0B906-1989-4F20-A93C-4C0F94C8DF9E}",
"{F1410A0A-8205-4D45-BF2B-9C7ACB2F4B24}",
"{61F2FFE4-56BA-4F5E-91FB-BD34F92E44CE}",
"{DC0C27E6-745B-4D0E-A2F7-47676BFAE25D}",
"{D901557E-8AF2-4F66-BE3C-B8C816397BD5}",
"{A37E9FA0-00FE-479D-9F62-E6E3DBA51D29}",
"{1D55DE93-486D-40F7-88F3-CF08578F82AA}",
"{F22C3C05-B1D9-47FF-AA17-4F9DCBFE850F}",
"{44C61B0B-3700-4AA6-AC7C-EE8F0BA9A907}",
"{2755BEE9-F03B-4FB8-BB71-0BA3F2629F18}",
"{2448A347-6E10-4FDE-AD25-74804743D184}",
"{B0069674-D80C-48CB-852D-88AD36EAB0A5}",
"{76CF5170-31B4-490F-89CE-5820EF416822}",
"{448D7DEC-36F1-4091-B419-C5487BDEB867}",
"{A580818A-6519-4120-AB1C-F4F6FCFAA7D0}",
"{DE3DB02A-3402-4CC4-AF65-B52AE8406739}",
"{9755D61E-3FC8-479D-BAD7-5516E0FE5281}",
"{8656EDBE-7C0A-4945-8D49-493FDBE7B5BD}",
"{0699CBD6-FFF5-4211-97A7-9C32E744F5F4}",
"{63A147A7-55F5-4305-A09C-696781D58B8A}",
"{BABDDB46-341A-460E-8F65-83C9B0BF7329}",
"{E29AC00B-7E6C-4770-A3FE-C3EE56C837C7}",
"{1C1655A5-8B59-421E-ABCC-9182956510DC}",
"{B2239F96-D221-45C4-81C7-386E9DB84DEB}",
"{8C3EAB4F-199B-456B-9840-9A95FDBAE125}",
"{B4A59659-1E69-4286-8885-3D0618B84894}",
"{7754B002-6B0F-4343-AAB9-20615AE6D7E1}",
"{CCF44D05-A254-49E9-A024-33D37C37962D}",
"{26E87568-C135-4C53-A3D9-62EC26C2D7A1}",
"{AC08189D-DBCB-40DB-8B36-0AC5F1B115BD}",
"{A186F2B3-64FC-4A3C-8096-B002A71F2A9B}",
"{2F881898-5300-4D68-AE46-F5FE074D59AA}",
"{A6FB0BFC-1F3F-42E0-BEAB-FA139FB54812}",
"{7B0961DB-15EB-41AF-85DA-C296924CA408}",
"{7898389E-2B8F-4CAC-A8CB-489B7B339C03}",
"{FB7D053D-9F6F-4E16-96BE-D2EF54C620AC}",
"{0C942CD9-6F38-498A-808F-C76EDBBA1969}",
"{0608F2B6-4E49-4AD0-9128-C122A34CFCE1}",
"{A7DC9721-4986-4179-BB89-A3E99545584C}",
"{737FA5F0-3227-4725-A59D-C89FC8625324}",
"{B2AD5A88-0714-44D9-8682-EDCE17671CDF}",
"{B5050B27-F758-4CE7-8BE5-49A436B4C1FC}",
"{8AA0E56A-5F80-413C-863D-67ED1E0DAC55}",
"{68D5A20B-B462-4EAB-968A-83E2599F4C50}",
"{C4E4BF86-4E27-4B8B-8BF9-A5BF1C7573A4}",
"{05A80D7B-5DB4-43DB-9D90-C647145CE5C1}",
"{DD6BBCC0-0CF8-4972-86DC-17437AFEE6C3}",
"{385454BE-576E-4FC8-A828-4C81F0485A7C}",
"{80C20E2F-B4EF-44E8-BF4A-6A625A9AF168}",
"{39BF25A5-AFEC-49C2-9991-24D9B38F3EDF}",
"{CE102F76-8858-4CA8-B500-030C9A735C8A}",
"{C66026EE-B45A-49AB-B221-313C478749D8}",
"{F7098593-2F4C-432C-AC8F-6D69DC9EFDC9}",
"{9368CBAA-BE94-4D4D-9D8A-75C44F86838A}",
"{9B0163AC-7E34-4A2F-A3E6-73440FF9549B}",
"{0B6C49F2-1CAB-42A7-AD1E-6BBDABA7426D}",
"{0A9A57A9-8D6E-4CBD-9434-A244E94D2154}",
"{B564F5EA-50DC-428D-AFBC-DE86FDC4BFCA}",
"{D633DF27-FC9E-4FDA-A158-CB36AE83671D}",
"{3A0E9113-0B4F-4664-B795-CB2F042EE126}",
"{1D95F7C4-A547-4FC9-91A4-A35B19F597C0}",
"{00D77C52-95CA-4E13-9ED1-1FE49E8F2D49}",
"{68E93C1A-9585-4C06-B294-1123FD7929BE}",
"{19CB28DE-66ED-46A2-A20E-C27B47CB5079}",
"{08A17A35-5362-453D-B788-AB76F5899684}",
"{190EDFFE-3B55-48A8-9827-AE4B7D3D9C3C}",
"{3D82C954-2957-418B-908F-FE78BF3A8BEB}",
"{6BD7E6C5-1A06-42EC-B056-50BC8E66E5B0}",
"{F26D7B9D-9E01-4293-92EF-0ACAD1B9CAEB}",
"{B6CD88CE-C761-41C5-A148-D6313D7C40EB}",
"{8E64FBD0-D3DA-41DB-B8D5-AB5F3111529B}",
"{665B290E-1BF1-4A8B-B3D2-F403AACD2B61}",
"{BD09A75D-86C0-4BBE-869D-2724DA1F9579}",
"{4C96288D-7068-4907-A4E0-B3CCF360D07B}",
"{0A95999C-4BF1-4DD7-9553-ED3BA6BB81A7}",
"{16AE4955-F0F9-4F5A-BD5C-103497695E01}",
"{B8ED0CDE-765A-4050-BC45-D7C4B226F73E}",
"{52D7D6CE-610A-4304-A78D-6BEB63BFCFB3}",
"{05E6D311-4793-44BE-ACA2-A50B5B5129AE}",
"{1E0228E7-7782-4C1F-855B-4B65831C080F}",
"{F8D6E598-115A-4686-A793-E67301E96A13}",
"{12F7DD6E-0D08-4E80-8013-B6F012010036}",
"{DD642527-3173-4D55-B4F0-3C4EAACC518D}",
"{D81D3303-7080-4052-8820-B3B5FCB1337A}",
"{9EA59C80-8DB7-4D85-9201-FED4CF6B81F5}",
"{74CBEE71-91DE-4284-8ED5-C8DD9DCD3EAF}",
"{34D4D627-00A1-4C0D-BF68-576C146B9ED6}",
"{2E386123-7BE0-41D4-9B2E-ABDD458D4689}",
"{CD50188C-689D-40E5-B7D0-B7C792753EF4}",
"{64CE5C88-144E-4F29-B114-61B0934C4FDE}",
"{158D6908-7A47-4126-BFB4-D0C2F9ACC9BE}",
"{3371DF75-3590-4993-A5D9-17F078B7DA16}",
"{4BFD2D24-8CBD-4B32-8DB0-FF2E0FD768F6}",
"{21B3267D-3C33-4D83-85F6-B02CADDB0BCB}",
"{BAF5175E-C27F-4252-81B9-E42F01E46CB6}",
"{A53A49C6-BC75-408C-A6A1-3A82303B53B9}",
"{FEE1FB25-E120-4FF9-A5F0-8F382D662AAA}",
"{33C197DA-06F4-4561-82A6-D0FB0BFF1127}",
"{E9E68605-DE3F-4B4C-871B-FEB06DC5D167}",
"{689FB589-F0ED-4E24-95F5-C7BE2AA77313}",
"{FFD6FA27-3734-44C2-9BCE-4FA90F5CAA64}",
"{9F19DEDF-69DA-4EF8-A2FF-7BD365FE95B6}",
"{56BE475E-FDAD-4717-BEB4-893CD0A6CADA}",
"{CCE4F06E-4C90-411C-954C-8F6EA7742BD1}",
"{696A028E-3E09-40A1-A827-CF1CCBEC41D4}",
"{1B245E96-5A2F-4516-95A8-C3790709880A}",
"{187F37F1-B47C-41C8-ADBA-8774D5C63A18}",
"{3F397EB0-22F3-4292-8BCC-AD2190403A87}",
"{A722EC6F-6F9B-4469-960C-E6D1C0390ECC}",
"{7363DCE8-460F-4CD6-8E2A-33CF600BDA0A}",
"{B7597EAE-2201-4300-9708-9536F46302FD}",
"{7D76B93C-CC5F-4DBF-9A3B-B83CDE70647D}",
"{41AE0BD1-8D5A-4AFF-AD64-955B2937D9E7}",
"{54EF661F-E276-4460-A986-64C38A31EE67}",
"{6006D428-182D-4FED-BE45-5C226A66C8FD}",
"{9837527E-C985-4A1E-845F-571EB6A0F6B2}",
"{AAA1427A-797B-4352-9E2B-2B2295529C90}",
"{E80E5B60-A240-4E09-B901-8D55A0C193EC}",
"{24A6034A-8B8B-431C-B498-C9D36AAE333D}",
"{521807A4-E62D-459C-8A31-991C20B81674}",
"{FDC0C70F-866A-49EF-A886-D7FE22409CDA}",
"{7C48CC6D-B17F-4B6F-8E52-5AA85C57E0C9}",
"{88BDE8D8-9230-477D-9601-C038D231203B}",
"{948044A3-D979-4347-B197-52276056DD34}",
"{B66B9A90-AB4F-42C7-97F6-057EA49F0C20}",
"{4C3B1ECE-5FAF-4C0C-83A8-348C60F4A928}",
"{01D02EF1-C348-4B64-BACF-860A69CBCADF}",
"{858ED7B0-C54F-4E69-97D5-20412C2D1B45}",
"{328DDB49-3672-44AB-9A22-00EF18025988}",
"{B61D1827-63CA-4B02-AB7F-B5F86C59388D}",
"{1ED4AB04-200D-412B-A06A-0B8E7217CCFD}",
"{73534489-BFE7-4E2D-9769-FDBA5C886DC2}",
"{A2FAFAA7-2B5D-4A41-934D-4F19EA3B7A61}",
"{BBD818F8-DF6A-42C8-86D8-6E04924F8D73}",
"{8E1831A2-E627-4026-AF98-5E6A9E2A4765}",
"{8160E92F-CA45-4380-86B2-2D25728950E6}",
"{E3ECA138-7EB5-417C-91CC-5C50E6F39F90}",
"{F681BDD7-A359-492D-B7B6-FEED028826E8}",
"{9C34B58B-4984-4102-8534-213D34AD6DBD}",
"{AC91BF91-1C7F-4623-8074-F4428467057B}",
"{AF43C656-6337-446A-A390-4C83DCD709A8}",
"{92F082BB-7B1B-46FF-A869-FE45B1DC2B2C}",
"{345C36DB-0502-4F55-8DBC-B630CF58362A}",
"{B26E42ED-232D-41F5-95B9-CD0004654111}",
"{A4C99918-2B9A-4FA1-AA53-3253D9A93C91}",
"{D131C579-DE6F-4CBC-9233-7EC7B4A08A02}",
"{93EBBE38-F20A-45B7-AE93-D3CAF35CD8EB}",
"{9D79E870-669E-4C5D-8FA4-72B34CC13859}",
"{03F3B23C-60C3-4B25-AA78-40093E489451}",
"{0DD89790-A2D6-4120-A3CC-6E3E8F72E42A}",
"{EBA73EE6-658C-4B6F-9AB1-1FE6E5A975EA}",
"{194B7081-9393-4063-8BAD-6B2927DA68F2}",
"{19A12FA9-5DBA-462E-B792-DE3D07725A5F}",
"{7D9940B6-B8F6-492A-91A6-16B9008A0767}",
"{93C4050D-A011-468F-B98A-B8A51D13110E}",
"{51914A90-F31F-4829-AD5C-3C25EABE53BB}",
"{46AEF8E1-716B-4DD6-B0C4-061110CB5F33}",
"{5E43AB7A-D441-4572-A426-7ABE52062E5B}",
"{734EDE2A-0CC5-4914-88A5-02B6E3D3D0B0}",
"{13698BC4-FEDF-48F3-91FC-AE54FF4C936C}",
"{2C303126-29CF-44CF-8E18-2266E9E185C1}",
"{04196C43-CE20-4F4C-9AD3-3CDFE197D418}",
"{3C8C726E-9B16-406F-883B-90958ABF2997}",
"{B7CB94F6-B20E-499F-987B-7269A41FD185}",
"{3D5C181E-07C2-4964-BD0F-76F14CA9A0DD}",
"{02FDB6BF-5846-4DC6-8992-AFC11AA384C4}",
"{64A903B0-853C-4057-9FAF-EEC08AA37EA0}",
"{E7871E72-00CA-4C49-B00B-85FF97A31765}",
"{C8CC6B0E-5486-46FD-B83D-6D6F5ABBB732}",
"{BC6E7713-D978-4529-9571-D2EEEC8F2935}",
"{E7AD52C5-7FD6-4961-BE5D-3D1707697BCC}",
"{0AB802C1-9508-4BC0-BBE2-5E55C6695123}",
"{CE4E7860-7887-4D1E-AD33-4261787F7B0A}",
"{DEA2B4CD-2B47-4BA6-8AB5-0A2220174D02}",
"{15941AEE-0613-4A48-9261-A1B004938498}",
"{46FB537C-F6F6-45B7-996F-33204AA6F9A6}",
"{62C6AA0C-EDEE-4051-B34E-A0E737B8FE2F}",
"{9F105385-9E8A-4711-BF79-CE6FA6517CD3}",
"{9802AB7D-9BB2-4FC9-A9B6-681696F1E2DA}",
"{61E8B062-51F9-4BBB-B1FC-E2A4A40944F5}",
"{84490045-A165-4E48-9513-F9624D2CEBEE}",
"{15769488-ECC7-482D-B222-96281A8C36C7}",
"{1E37DD02-3E30-49B6-9FF2-F4A3DFF95717}",
"{EAC34337-5F49-41FF-86C6-A370DAB69CB2}",
"{F201F161-D43B-471A-A9E5-C432E1BA196B}",
"{35657C68-91B5-42EC-99E6-0BA43106AF8B}",
"{E09CDDD4-060D-4BF4-AB36-C13AD9AD63A3}",
"{0234731F-1444-4215-BBCE-968CDDB4BCA4}",
"{22A5BE4F-4A7C-4037-8E30-EAF0E6CB546C}",
"{B91D3B4D-001F-4ABF-B8A5-B5A926DB63AD}",
"{04B848BE-8B67-4B44-929D-BC14D9B4FFF4}"
)
 

 #These are the SIDs of each version of FlashPlayer and they can be found by Searching "Flash Player" in this Key: HKLM:\SOFTWARE\CLASSES\Installer\Features\.
 #There is one for the ActiveX and one for NPAPI Plugin.
 $SID = @("3958907FC4F2C234CAF8D696CDE9DF9C",
 "4C7F59D1745A9CF4194A3AB5915F790C",
 "68FB4E4C72E4B8B4B89F5AFBC157374A",
 "88A5DA2B41709D446828DEEC7176C1FD",
 "F2E02C08FE4B8E44FBA4A626A5A91F86",
 "0CC08665D4AABD741A3A2BA6791F3D1F",
 "99D9FA22089A17040ADBD1B09B659BAE",
 "4C7F59D1745A9CF4194A3AB5915F790C",
 "72FD336DE9CFADF41A85BC63EA3876D1",
 "1B335E8592B9D234BB83524B981C5DB3",
 "CA3610B943E7F2A43A6E3744F09F45B9",
 "9A75A9A0E6D8DBC449432A449ED41245",
 "7BB2D6E6448B24846BD2A0F7A07A88E4",
 "67F201EC85888AC45B0030C0A937C5A8",
 "86578E62531C35C43A9D26CE622C7D1A",
 "69AFBA70EFA72C34B92C01502CD43261",
 "67F201EC85888AC45B0030C0A937C5A8",
 "21FE8983AA676114FBECAE6043029B2E",
 "50D44FCC452A9E940A42333DC77369D2",
 "66126548E8733C049873EFBA75DB431C",
 "E156B104CCC477141BD6B188CEF9FD3B",
 "200B4577F0B63434AA9B0216A56E7D1E",
 "95695A4B96E168248858D360818B8449",
 "374BFC73E66AE094E82D709C48CB245F",
 "F4BAE3C8B991B6548904A959DFAB1E52",
 "A5EDFA0DEF610B0409D8365A2FA3E3F7",
 "8C0194B495D42CA4E927519B9DC1BE2B",
 "69F9322B122D4C54187C83E6D98BD4BE",
 "F1D4BF78A314F3F4AA9DB031A020AB16",
 "5A5561C195B8E124BACC1928595601CD",
 "0418CB86AAF391446BEECC6FB06EAD2B",
 "1279CD7A68949714BB983A9E595485C4",
 "19223B4C2B7FCEB4ABD4145976A680CC",
 "1E36145BD4A3BEE4189FAF44B9E3831B",
 "39ED55D1D6847F04883FFC8075F828AA",
 "4769600BC08DBC8458D288DA63AE0B5A",
 "4EFF2F16AB65E5F419BFDB439FE244EC",
 "54ADAD3BDE0FDF8449E6E7282C22D995",
 "5E8B1F381BB60934C9712D391F430FEB",
 "609B0F01989102F49AC3C4F0498CFDE9",
 "6B2F806094E40DA419821C223AC4CF1E",
 "87143C29976B38C4CA33E7CF6E3DE610",
 "898188F2003586D4EA645FEF70D495AA",
 "9BD4FC44A707593438C975F3CB02C69B",
 "9DC249C083F6A89408F87CE6BDAB9196",
 "A818085A91560214BAC14F6FCFAF7A0D",
 "B02A2D982C4707A45B89AAF4D4CFE0FB",
 "B0B16C4400736AA4CAC7EEF8B09A9A70",
 "C5E8844A2201A2340866271E4C203301",
 "C71265EE9F3BB2044BCE360F095FD1D3",
 "C91FBBC696B23414184C5D5BD62380C8",
 "CED7D8441F6319044B915C84B7ED8B76",
 "CFB0BF6AF3F10E24EBBAAF31F95B8421",
 "D350D7BFF6F961E469EB2DFE456C02CA",
 "DFA7D12D3FD80FE48BB12AAAA5FE7E31",
 "ED6A9CF3501C6754F83656F6BFB18FBE"

)


# Function to delete registry key
function DeleteRegistryKey ($Path) {
    if(Test-Path -Path $Path){
        Write-Host "Deleting registry key $Path..."
        Remove-Item -path $Path -Recurse -ErrorAction SilentlyContinue
        Write-Host "Successfully deleted $Path"
    }
}

# Iterate through each GUID and run msiexec to uninstall
foreach ($guid in $guids) {
    Write-Host "Uninstalling application with GUID: $guid"
    Start-Process -FilePath "msiexec.exe" -ArgumentList "/x $guid /qn" -Wait

    $regPaths = @(
        "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$guid",
        "HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\$guid"
    )

    $UIPath = "C:\Windows\Installer\$guid\"
    Write-Host "Removing item property $UIPath..."
    Remove-ItemProperty -Path "hklm:\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\Folders" -Name $UIPath -ErrorAction SilentlyContinue
    Remove-ItemProperty -Path "hklm:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Installer\Folders" -Name $UIPath -ErrorAction SilentlyContinue
    Write-Host "Item property removed."

    foreach ($regPath in $regPaths) {
        DeleteRegistryKey $regPath
    }
}


foreach ($SIDS in $SID) {
    $sidPaths = @(
        "HKLM:\SOFTWARE\CLASSES\Installer\Features\$SIDS",
        "HKLM:\SOFTWARE\Classes\Installer\Products\$SIDS",
        "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\UserData\S-1-5-18\Products\$SIDS",
        "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\UserData\S-1-5-18\Components\$SIDS",
        "HKLM:\SOFTWARE\Wow6432Node\CLASSES\Installer\Features\$SIDS",
        "HKLM:\SOFTWARE\Wow6432Node\Classes\Installer\Products\$SIDS",
        "HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Installer\UserData\S-1-5-18\Products\$SIDS"
    )

    foreach ($sidPath in $sidPaths) {
        DeleteRegistryKey $sidPath
    }
}




# Main removal process
$extensions = @('*.ocx', '*.dll', '*.exe')
$paths = @("C:\Windows\System32\Macromed\Flash", "C:\Windows\SysWOW64\Macromed\Flash", "C:\Users")

foreach ($path in $paths) {
    foreach ($ext in $extensions) {
        Get-ChildItem -Path $path -Filter $ext -File -Recurse -Force -ErrorAction SilentlyContinue |
        Where-Object { $_.BaseName -match 'flash|NPSWF' } |
        ForEach-Object {
            Write-Host ("Found file: " + $_.FullName)
            
            # Check if file is open and close it
            Close-FileHandle $_.FullName

            # Delete the file
            Write-Host "Deleting the file $_.FullName..."
            Remove-Item $_.FullName -ErrorAction SilentlyContinue
            Write-Host "File deleted."
        }
    }
}

$keysToDelete = @(
    "HKLM:\SOFTWARE\Macromedia\FlashPlayer",
    "HKLM:\SOFTWARE\WOW6432Node\Macromedia\FlashPlayer",
    "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\Adobe Flash Player ActiveX"
)

foreach ($key in $keysToDelete) {
    DeleteRegistryKey $key


 Write-Host "Any Detected Flash SIDs have been deleted"
 Write-Host "All Adobe Flash Installations and Related Files Have Been Sucessfully Removed"

# Stop the transcript log
Write-Host "Stopping the log..."
Stop-Transcript
